@page
@model BankApplication.Pages.AccountModel
@{
    ViewData["Title"] = "Transactions";
    Layout = "_DashboardLayout";
}


<h2>Konto: @Model.Account.AccountId</h2>
<p>Saldo: @Model.Account.Balance.ToString("C")</p>

<table class="table">
    <thead>
        <tr>
            <th>Datum</th>
            <th>Typ</th>
            <th>Operation</th>
            <th>Belopp</th>
            <th>Saldo</th>
        </tr>
    </thead>
    <tbody id="transactionList">
        @foreach (var t in Model.Account.Transactions)
        {
            <tr>
                <td>@t.Date.ToString("yyyy-MM-dd")</td>
                <td>@t.Type</td>
                <td>@t.Operation</td>
                <td>@t.Amount.ToString("C")</td>
                <td>@t.Balance.ToString("C")</td>
            </tr>
        }
    </tbody>
</table>

<button id="loadMoreBtn" class="btn btn-primary">Ladda fler</button>

@section Scripts {
<script>
    let skip = 20;
    const accountId = @Model.Account.AccountId;

           document.getElementById("loadMoreBtn").addEventListener("click", function () {
            fetch(`/Account?handler=LoadMore&accountId=${accountId}&skip=${skip}`)
                .then(response => response.json())
                .then(data => {
                    const tbody = document.getElementById("transactionList");
                    data.transactions.forEach(t => {
                        const row = document.createElement("tr");
                        row.innerHTML = `
                            <td>${new Date(t.date).toLocaleDateString()}</td>
                            <td>${t.type}</td>
                            <td>${t.operation}</td>
                            <td>${t.amount.toLocaleString('sv-SE', { style: 'currency', currency: 'SEK' })}</td>
                            <td>${t.balance.toLocaleString('sv-SE', { style: 'currency', currency: 'SEK' })}</td>
                        `;
                        tbody.appendChild(row);
                    });

                    skip += data.transactions.length;
                    if (!data.hasMore) {
                        document.getElementById("loadMoreBtn").style.display = 'none';
                    }
                });
        });

</script>
}
